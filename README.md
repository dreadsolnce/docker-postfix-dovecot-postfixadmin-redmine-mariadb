# docker-postfix-dovecot-postfixadmin-redmine-mariadb
+ Простой почтовый сервер для локальной сети с авторизацией почтовых ящиков с помощью нешифрованных паролей.

# Предварительные условия
* Запущенный Docker на хостовой машине.
* Запущенный Docker compose на хостовой машине.
* Базовые знания по работе с Docker 

# Описание и структура проекта:
* cfg - каталог с неизменяемыми конфигурационными файлами
* data - каталог базы данных почтовых ящиков
* dockerfile - содержит настраиваемый образ в зависимости от переменных окружения заданных в файле .env
*  - dovecot - конф.файлы программ dovecot и postfix, которые настраиваются в зависимости от файла .env при сборке образа.
*  - postfix - ...
* .env.example - файл с используемыми переменными окружения. Данный файл следует переименовать в файл .env
* docker-compose.yml - основной файл с используемыми сервисами.

# Установка
+ clone the repo.
+ `mv .env.example .env`
+ запустите `docker-compose up -d` для запуска контейнеров.

# Настройка
+ создать почтовый ящик через программу postfixadmin:
- - http://127.0.0.1:82/setup.php
+ - - сформировать хэш пароля установки, для этого ввести и повторить пароль и нажать кнопку [ Generate setup_password hash ]
+ - - скопировать полученный хэш и вставить в файл .env (переменная HASH_SETUP_PASSWORD)
+ - - перезапустить контейнер postfixadmin:
      >     docker compose stop postfixadmin
      >     docker compose up -d postfixadmin
+ - http://127.0.0.1:82/setup.php
+ - - в поле Setup password ввести введённый ранее пароль
+ - - создать учётную запись администратора:
      >     Setup password: введенный ранее пароль
      >     Админ: имя учётной записи в виде доменной записи (например: admin@example.local)
      >     Пароль: пароль
      >     Пароль (ещё раз): повторить пароль
      `Нажать кнопку [ Добавить администратора ]`
- - http://127.0.0.1:82/login.php
+ - - войти в программу с учётной записью администратора
+ - - создать домен: Список доменов -> новый домен
      >     Домен: имя домена (например: example.local)
      >     описание: описание (например: тестовый домен)
      `Нажать кнопку [ Добавить домен ]`
+ - - создать почтовый ящик: Обзор -> создать ящик
      >     Название: petrov 
      >     Пароль: указать новый пароль 
      >     Пароль (ещё раз): повторить пароль
      >     Имя: Петров
      `Нажать кнопку [Создать ящик]`

# Проверка

## thunderbird:
+ открыть программу почтового клиента (например: thunderbird):
+ - выполнить настройки подключений программы:
    - Сервер входящей почты:
      >     Тип сервера: Почтовый сервер IMAP
      >     Имя сервера: mail.example.local
      >       (mail -          имя сервера  (POSTFIX_HOST_NAME))
      >       (example.local - имя домена (POSTFIX_DOMAIN_NAME)) 
      >     Имя пользователя: petrov@example.local
      >     Порт: 143
      > 
      >     Настройка защиты:
      >     Защита соеденения: Нет
      >     Метод аутентификации: Пароль, без защиты передачи
    - Сервер исходящей почты:
      >     Описание: локальный тестовый сервер
      >     Имя сервера: mail.example.local
      >       (mail -          имя сервера  (POSTFIX_HOST_NAME))
      >       (example.local - имя домена (POSTFIX_DOMAIN_NAME)) 
      >     Порт: 25
      > 
      >     Защита и аутентификация:
      >     Защита соеденения: Нет
      >     Метод аутентификации: Без аутентификации
+ перезапустить программу почтового клиента
+ произвести аутентификацию почтового ящика введя пароль от почтового ящика
+ для проверки создать письмо и отправить самому себе

## redmine:
+ http://127.0.0.1:81
    - учётные данные по умолчанию:
      >     Пользователь: admin
      >     Пароль: admin
    - необходимо изменить пароль по умолчанию:
      >     Текущий пароль: admin
      >     Новый пароль: <новый пароль>
      >     Подтверждение: <новый пароль>
    - заполнить поля учётной записи
      >     Имя: Admin
      >     Фамилия: Adminov
      >     Email: petrov@example.local
      `Нажать кнопку [Сохранить]`
# Используемы images:
+ redis:alpine
+ postgres:9.5-alpine
+ rabbitmq:3-management-alpine
+ nginx:alpine
+ php:8.2-fpm



